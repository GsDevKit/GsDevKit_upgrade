set -e
. defStone.env
export vers="3.5.0_g"

rm -f *.log *.out

# createStone -g battery_343 3.4.3

sourceStoneName="battery_343"
stopStone $sourceStoneName
stopStone $GEMSTONE_NAME

newExtent -s snapshots/extent0_upgradeImage_343.dbf $GEMSTONE_NAME

export upgradeLogDir=`pwd`/upgradeLogDir

startStone -b -w 5 $GEMSTONE_NAME

pushd "${upgradeLogDir}" >& /dev/null
  # start standard upgrade
	rm -f *.log *.out
  echo "STARTING standard upgradeImage "
	startTopaz $GEMSTONE_NAME -lq < $GS_HOME/shared/repos/GsDevKit_upgradeDevKitImage/bin/installGsDevKit_upgrade_343
	startTopaz $GEMSTONE_NAME -lq < $GS_HOME/shared/repos/GsDevKit_upgradeDevKitImage/bin/prepareGsDevKitImage
	startTopaz $GEMSTONE_NAME -lq < $GS_HOME/shared/repos/GsDevKit_upgradeDevKitImage/bin/prepareGsDevKitImage_user
	startTopaz $GEMSTONE_NAME -lq < $GS_HOME/shared/repos/GsDevKit_upgradeDevKitImage/bin/runImageTests
popd

 stopStone $GEMSTONE_NAME
 cp extents/extent0.dbf snapshots/extent0_preparedGsDevKitImage_343.dbf

