set -e
. defStone.env
export vers="3.5.0_g"

rm -f *.log *.out

# createStone -g battery_3215 3.2.15

sourceStoneName="battery_3215"
stopStone $sourceStoneName
stopStone $GEMSTONE_NAME

newExtent -s snapshots/extent0_upgradeImage_3215.dbf $GEMSTONE_NAME

export upgradeLogDir=`pwd`/upgradeLogDir

startStone -b -w 5 $GEMSTONE_NAME

pushd "${upgradeLogDir}" >& /dev/null
  # start standard upgrade
	rm -f *.log *.out
  echo "STARTING standard upgradeImage "
	startTopaz $GEMSTONE_NAME -lq < $GS_HOME/shared/repos/GsDevKit_upgradeDevKitImage/bin/installGsDevKit_upgrade_3215
	startTopaz $GEMSTONE_NAME -lq < $GS_HOME/shared/repos/GsDevKit_upgradeDevKitImage/bin/prepareGsDevKitImage
	startTopaz $GEMSTONE_NAME -lq < $GS_HOME/shared/repos/GsDevKit_upgradeDevKitImage/bin/prepareGsDevKitImage_pragma_user
	startTopaz $GEMSTONE_NAME -lq < $GS_HOME/shared/repos/GsDevKit_upgradeDevKitImage/bin/prepareGsDevKitImage_pragma_SystemUser
	startTopaz $GEMSTONE_NAME -lq -T 500000 < $GS_HOME/shared/repos/GsDevKit_upgradeDevKitImage/bin/prepareGsDevKitImage_user

	stopStone $GEMSTONE_NAME
	cp ../extents/extent0.dbf ../snapshots/extent0_preparedGsDevKitImage_3215.dbf
	startStone $GEMSTONE_NAME

	startTopaz $GEMSTONE_NAME -lq < $GS_HOME/shared/repos/GsDevKit_upgradeDevKitImage/bin/runImageTests
popd

